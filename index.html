<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ñ‡∏ß‡∏≤‡∏¢‡∏™‡∏±‡∏ï‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ç‡∏≤‡∏ì</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Srisakdi:wght@700&display=swap"
      rel="stylesheet"
    />
    <script
      charset="utf-8"
      src="https://static.line-scdn.net/liff/edge/2/sdk.js"
    ></script>
    <style>
      body {
        font-family: "Srisakdi", sans-serif;
        background: url("https://res.cloudinary.com/gukkghu/image/upload/v1752866998/%E0%B8%AA%E0%B8%B3%E0%B9%80%E0%B8%99%E0%B8%B2%E0%B8%82%E0%B8%AD%E0%B8%87_7_-_%E0%B9%80%E0%B8%89%E0%B8%A5%E0%B8%B4%E0%B8%A1%E0%B8%9E%E0%B8%A3%E0%B8%B0%E0%B8%8A%E0%B8%99%E0%B8%A1%E0%B8%9E%E0%B8%A3%E0%B8%A3%E0%B8%A9%E0%B8%B2_6_%E0%B8%A3%E0%B8%AD%E0%B8%9A_%E0%B8%A310_komxqy.png")
          no-repeat center center fixed;
        background-size: cover;
      }

      @media screen and (max-width: 768px) {
        body {
          background-image: url("https://res.cloudinary.com/gukkghu/image/upload/v1752897099/%E0%B8%97%E0%B8%A3%E0%B8%87%E0%B8%9E%E0%B8%A3%E0%B8%B0%E0%B9%80%E0%B8%88%E0%B8%A3%E0%B8%B4%E0%B8%8D_3_it2fkp.png");
        }
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }
      .signature-pad {
        border: 2px dashed #d97706;
        background-color: #fff;
        border-radius: 0.5rem;
      }
      .fade-in {
        animation: fadeIn 0.3s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .popup {
        animation: popupSlide 0.5s ease-out;
      }
      .oath-text {
        font-family: "Srisakdi", cursive;
        color: #d4af37; /* ‡∏™‡∏µ‡∏ó‡∏≠‡∏á */
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        font-size: 0.95rem;
        line-height: 1.8;
      }
      #imgsig {
        max-width: 100%;
        height: auto;
        margin: 0 auto;
        margin-top: 0.7rem;
        margin-bottom: 1rem;
      }

      @keyframes popupSlide {
        0% {
          opacity: 0;
          transform: translateY(-50px) scale(0.8);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
    </style>
  </head>
  <body class="min-h-screen flex justify-end items-center p-6">
    <div
      class="rounded-full w-20 h-20 absolute top-3 right-6 bg-pink-400 bg-opacity-70"
    >
      <img
        id="showimgProfile"
        src="https://res.cloudinary.com/gukkghu/image/upload/v1646575846/gukkghu/%E0%B8%87%E0%B8%B2%E0%B8%99%E0%B8%AD%E0%B8%AD%E0%B8%81%E0%B9%81%E0%B8%9A%E0%B8%9A%E0%B8%97%E0%B8%B5%E0%B9%88%E0%B9%84%E0%B8%A1%E0%B9%88%E0%B8%A1%E0%B8%B5%E0%B8%8A%E0%B8%B7%E0%B9%88%E0%B8%AD_aytvpq.png"
        width="full"
        alt=""
      />
    </div>
    <!-- Main Form Card -->
    <div
      id="formWrapper"
      class="hidden fixed inset-0 z-40 sm:inset-auto sm:right-4 sm:bottom-4 w-full sm:max-w-lg flex items-center justify-center p-2 sm:p-0"
    >
      <div
        class="glass-card w-full max-w-lg rounded-xl p-4 sm:pt-2 sm:p-6 space-y-6 z-10 max-h-[90vh] overflow-y-auto"
      >
        <div class="flex justify-end">
          <button
            onclick="toggleForm()"
            class="text-gray-600 hover:text-red-500 text-xl font-bold"
          >
            ‚úñ
          </button>
        </div>

        <div class="text-center">
          <div class="flex justify-center">
            <img
              src="https://res.cloudinary.com/gukkghu/image/upload/v1646575846/gukkghu/%E0%B8%87%E0%B8%B2%E0%B8%99%E0%B8%AD%E0%B8%AD%E0%B8%81%E0%B9%81%E0%B8%9A%E0%B8%9A%E0%B8%97%E0%B8%B5%E0%B9%88%E0%B9%84%E0%B8%A1%E0%B9%88%E0%B8%A1%E0%B8%B5%E0%B8%8A%E0%B8%B7%E0%B9%88%E0%B8%AD_aytvpq.png"
              width="120px"
              alt=""
            />
          </div>
          <h1 class="text-lg font-bold text-amber-700">
            ‡∏Ç‡∏≠‡πÄ‡∏ä‡∏¥‡∏ç‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏π ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô
          </h1>
          <p class="text-md text-amber-600">
            ‡∏£‡πà‡∏ß‡∏°‡∏•‡∏á‡∏ô‡∏≤‡∏°‡∏ñ‡∏ß‡∏≤‡∏¢‡∏™‡∏±‡∏ï‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ç‡∏≤‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÅ‡∏•‡∏∞<br />

            ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô
          </p>
        </div>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏ß‡∏≤‡∏¢‡∏™‡∏±‡∏ï‡∏¢‡πå -->
        <!-- <div class="bg-white bg-opacity-70 rounded-xl p-1 text-center"></div> -->

        <form id="loyaltyForm" class="space-y-4">
          <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
          <div>
            <label class="block text-sm font-semibold text-amber-800 mb-1"
              >‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ *</label
            >
            <select
              name="status"
              required
              class="w-full p-2.5 rounded border border-amber-300 bg-white focus:outline-amber-500 text-sm"
            >
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
              <option value="‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô">‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</option>
              <option value="‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£" selected>‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
            </select>
          </div>

          <!-- ‡∏ä‡∏∑‡πà‡∏≠ -->
          <div>
            <label class="block text-sm font-semibold text-amber-800 mb-1"
              >‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label
            >
            <input
              name="fullName"
              type="text"
              required
              placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
              class="w-full p-2.5 rounded border border-amber-300 bg-white focus:outline-amber-500 text-sm"
            />
          </div>

          <!-- ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô -->
          <div id="agencyField" class="hidden fade-in">
            <label class="block text-sm font-semibold text-amber-800 mb-1"
              >‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô *</label
            >
            <input
              name="agency"
              type="text"
              placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"
              class="w-full p-2.5 rounded border border-amber-300 bg-white focus:outline-amber-500 text-sm"
              value="‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏ß‡∏±‡∏î‡πÑ‡∏ó‡∏¢‡∏á‡∏≤‡∏°"
            />
          </div>

          <!-- ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á -->
          <div id="positionField" class="hidden fade-in">
            <label class="block text-sm font-semibold text-amber-800 mb-1"
              >‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label
            >
            <input
              name="position"
              type="text"
              placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"
              class="w-full p-2.5 rounded border border-amber-300 bg-white focus:outline-amber-500 text-sm"
            />
          </div>

          <!-- ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô -->
          <div>
            <label class="block text-sm font-semibold text-amber-800 mb-1"
              >‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô *</label
            >
            <canvas
              id="signaturePad"
              class="signature-pad w-full h-32"
            ></canvas>
            <div class="flex justify-between items-center mt-2">
              <button
                type="button"
                id="clearSignature"
                class="text-sm text-white bg-gray-500 px-3 py-1 rounded hover:bg-gray-600"
              >
                ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
              </button>
              <span class="text-xs text-gray-600">‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</span>
            </div>
          </div>

          <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á -->
          <button
            type="submit"
            id="submitBtn"
            class="w-full bg-gradient-to-r from-amber-500 to-yellow-500 text-white font-bold py-3 rounded-lg hover:from-amber-600 hover:to-yellow-600 transition-all"
          >
            <span id="submitText">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
            <span id="loadingText" class="hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...</span>
          </button>
        </form>
      </div>
    </div>
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° -->
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° -->
    <button
      id="openFormBtn"
      onclick="toggleForm()"
      class="absolute bottom-4 left-1/2 -translate-x-1/2 sm:fixed sm:right-4 sm:bottom-4 sm:left-auto sm:translate-x-0 z-50 bg-gradient-to-r from-yellow-400 to-amber-500 text-white font-bold py-4 px-6 sm:py-6 sm:px-10 rounded-full shadow-lg hover:scale-105 transition-all text-lg sm:text-2xl md:text-xl border border-gray-400"
    >
      ‚úçÔ∏è ‡∏£‡πà‡∏ß‡∏°‡∏•‡∏á‡∏ô‡∏≤‡∏°
    </button>

    <!-- Popup -->
    <div
      id="successPopup"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-white rounded-xl p-6 text-center popup w-full max-w-xs sm:max-w-sm mx-4"
      >
        <div class="text-4xl mb-1"></div>
        <div class="oath-text leading-relaxed">
          ‡∏Ç‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡πÄ‡∏à‡πâ‡∏≤ ‡∏Ç‡∏≠‡∏ñ‡∏ß‡∏≤‡∏¢‡∏™‡∏±‡∏ï‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ç‡∏≤‡∏ì‡∏ß‡πà‡∏≤
          ‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô
          ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå‡∏™‡∏∏‡∏à‡∏£‡∏¥‡∏ï ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏£‡∏≠‡∏¢‡∏ï‡∏≤‡∏°‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏¢‡∏∏‡∏Ñ‡∏•‡∏ö‡∏≤‡∏ó
          ‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô‡πÅ‡∏ô‡πà‡∏ß‡πÅ‡∏ô‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ä‡∏≤‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô
          ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÅ‡∏Å‡πà‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô
          ‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÇ‡∏î‡∏¢‡∏¢‡∏∂‡∏î‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡∏Ñ‡∏≥‡∏™‡∏≠‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏®‡∏≤‡∏™‡∏ô‡∏≤
          ‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏û‡∏£‡∏∞‡∏ö‡∏£‡∏°‡∏£‡∏≤‡πÇ‡∏ä‡∏ß‡∏≤‡∏ó‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ
        </div>
        <p class="text-md text-amber-600 mb-1">
          ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Å‡∏•‡πâ‡∏≤ ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏∞‡∏´‡∏°‡πà‡∏≠‡∏° ‡∏Ç‡∏≠‡πÄ‡∏î‡∏ä‡∏∞ ‡∏Ç‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡πÄ‡∏à‡πâ‡∏≤
        </p>
        <p class="text-md text-amber-600 mb-2" id="namesig"></p>
        <img src="" alt="" id="imgsig" />
        <button
          onclick="closePopup()"
          class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded"
        >
          ‡∏õ‡∏¥‡∏î
        </button>
      </div>
    </div>

    <!-- Script -->
    <script>
      const canvas = document.getElementById("signaturePad");
      const signaturePad = new SignaturePad(canvas, {
        backgroundColor: "rgba(0, 0, 0, 0)", // ‚úÖ ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™
        penColor: "#d4af37", // ‡∏™‡∏µ‡∏ó‡∏≠‡∏á
      });

      function resizeCanvas() {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;

        canvas.getContext("2d").scale(ratio, ratio);
        signaturePad.clear();
      }

      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();

      document
        .getElementById("clearSignature")
        .addEventListener("click", () => signaturePad.clear());

      document
        .querySelector('[name="status"]')
        .addEventListener("change", function () {
          const isGov = this.value === "‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£";
          document
            .getElementById("agencyField")
            .classList.toggle("hidden", !isGov);
          document
            .getElementById("positionField")
            .classList.toggle("hidden", !isGov);
          document.querySelector('[name="agency"]').required = isGov;
          document.querySelector('[name="position"]').required = isGov;
        });

      document
        .getElementById("loyaltyForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          if (signaturePad.isEmpty())
            return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

          const submitBtn = document.getElementById("submitBtn");
          const submitText = document.getElementById("submitText");
          const loadingText = document.getElementById("loadingText");

          submitBtn.disabled = true;
          submitText.classList.add("hidden");
          loadingText.classList.remove("hidden");

          try {
            const formData = new FormData(this);
            const data = {
              status: formData.get("status"),
              fullName: formData.get("fullName"),
              agency: formData.get("agency") || "",
              position: formData.get("position") || "",
              signature: signaturePad.toDataURL(),
              timestamp: new Date().toLocaleString("th-TH"),
            };

            const response = await fetch(
              "https://script.google.com/macros/s/AKfycbzp0eG_wEm1QWRvhK7pFEnHrKN0F7GAuRuS6pBnT_t2KJQf9YWvu1s0ePSicXnHGT9i/exec",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams(data),
              }
            );

            if (response.ok) {
              const result = await response.json(); // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á response ‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏Å‡πà‡∏≠‡∏ô
              console.log(result.fileUrl); // ‚úÖ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á fileUrl ‡πÑ‡∏î‡πâ

              document.getElementById("namesig").innerText = `${data.fullName}`;
              document.getElementById("imgsig").src = data.signature;

              showSuccessPopup();

              sendFlexToLINE(data.fullName, result.fileUrl); // ‚úÖ ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ
            } else {
              console.error("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", response.statusText);
            }
            this.reset();
            signaturePad.clear();
          } catch (err) {
            console.error(err);
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
          } finally {
            submitBtn.disabled = false;
            submitText.classList.remove("hidden");
            loadingText.classList.add("hidden");
          }
        });

      function showSuccessPopup() {
        document.getElementById("successPopup").classList.remove("hidden");
      }
      function closePopup() {
        document.getElementById("successPopup").classList.add("hidden");
      }
      function toggleForm() {
        const formWrapper = document.getElementById("formWrapper");
        const openFormBtn = document.getElementById("openFormBtn");

        const isHidden = formWrapper.classList.contains("hidden");

        formWrapper.classList.toggle("hidden");

        if (isHidden) {
          openFormBtn.classList.add("hidden");
          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å resizeCanvas ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
          setTimeout(() => resizeCanvas(), 100); // ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÉ‡∏´‡πâ DOM ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
        } else {
          openFormBtn.classList.remove("hidden");
        }
      }

      window.addEventListener("DOMContentLoaded", async () => {
        await liff.init({ liffId: "1657704109-dZayMMoA" }); // <-- ‡πÉ‡∏™‡πà LIFF ID ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

        if (!liff.isLoggedIn({ redirectUri: window.location.href })) {
          liff.login(); // ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          return;
        }

        const profile = await liff.getProfile();
        console.log("üë§ LINE Profile:", profile);
        document.getElementById('showimgProfile').src = profile.pictureUrl || "https://png.pngtree.com/png-clipart/20200224/original/pngtree-male-avatar-simple-cartoon-design-png-image_5230556.jpg"

        const status = document.querySelector('[name="status"]').value;
        const isGov = status === "‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£";

        document
          .getElementById("agencyField")
          .classList.toggle("hidden", !isGov);
        document
          .getElementById("positionField")
          .classList.toggle("hidden", !isGov);
        document.querySelector('[name="agency"]').required = isGov;
        document.querySelector('[name="position"]').required = isGov;

        resizeCanvas();
      });

      async function sendFlexToLINE(fullName, signature) {
        const imageBlock = signature
          ? {
              type: "image",
              url: signature,
              size: "full", // ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏ô‡∏ß‡∏Å‡∏ß‡πâ‡∏≤‡∏á
              aspectMode: "fit", // ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
              aspectRatio: "3:1", // ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏Å‡∏ß‡πâ‡∏≤‡∏á)
            }
          : null;

        const contents = [
          {
            type: "text",
            text: '"‡∏Ç‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡πÄ‡∏à‡πâ‡∏≤ ‡∏Ç‡∏≠‡∏ñ‡∏ß‡∏≤‡∏¢‡∏™‡∏±‡∏ï‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ç‡∏≤‡∏ì‡∏ß‡πà‡∏≤\n‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏ï‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏î‡∏µ\n‡πÅ‡∏•‡∏∞‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô\n‡∏î‡∏ã‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏ï‡∏¢‡πå‡∏™‡∏∏‡∏à‡∏£‡∏¥‡∏ï‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏£‡∏≠‡∏¢‡∏ï‡∏≤‡∏°‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏¢‡∏∏‡∏Ñ‡∏•‡∏ö‡∏≤‡∏ó\n‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô‡πÅ‡∏ô‡πà‡∏ß‡πÅ‡∏ô‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏ß‡∏°\n ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÅ‡∏Å‡πà‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞\n‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÇ‡∏î‡∏¢‡∏¢‡∏∂‡∏î‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡∏Ñ‡∏≥‡∏™‡∏≠‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏®‡∏≤‡∏™‡∏ô‡∏≤\n‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏û‡∏£‡∏∞‡∏ö‡∏£‡∏°‡∏£‡∏≤‡πÇ‡∏ä‡∏ß‡∏≤‡∏ó‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ"',
            align: "center",
            wrap: true,
            size: "sm",
            color: "#7B4019",
          },
          {
            type: "box",
            layout: "vertical",
            contents: [
              ...(imageBlock ? [imageBlock] : []), // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
              {
                type: "text",
                text: "‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Å‡∏•‡πâ‡∏≤ ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏∞‡∏´‡∏°‡πà‡∏≠‡∏° ‡∏Ç‡∏≠‡πÄ‡∏î‡∏ä‡∏∞\n" + fullName,
                align: "center",
                wrap: true,
                size: "sm",
                color: "#7B4019",
                margin: "md",
              },
            ],
            backgroundColor: "#FFEEA9",
            paddingStart: "20px",
            paddingEnd: "20px",
            margin: "md",
          },
        ];

        const flexMessage = {
          type: "flex",
          altText: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏ñ‡∏ß‡∏≤‡∏¢‡∏™‡∏±‡∏ï‡∏¢‡πå‡∏õ‡∏è‡∏¥‡∏ç‡∏≤‡∏ì",
          contents: {
            type: "bubble",
            size: "giga",
            hero: {
              type: "image",
              url: "https://res.cloudinary.com/gukkghu/image/upload/v1752866998/%E0%B8%AA%E0%B8%B3%E0%B9%80%E0%B8%99%E0%B8%B2%E0%B8%82%E0%B8%AD%E0%B8%87_7_-_%E0%B9%80%E0%B8%89%E0%B8%A5%E0%B8%B4%E0%B8%A1%E0%B8%9E%E0%B8%A3%E0%B8%B0%E0%B8%8A%E0%B8%99%E0%B8%A1%E0%B8%9E%E0%B8%A3%E0%B8%A3%E0%B8%A9%E0%B8%B2_6_%E0%B8%A3%E0%B8%AD%E0%B8%9A_%E0%B8%A310_komxqy.png",
              size: "full",
              aspectRatio: "16:9",
              aspectMode: "cover",
              action: { type: "uri", uri: "https://line.me/" },
            },
            body: {
              type: "box",
              layout: "vertical",
              contents,
              backgroundColor: "#FFEEA9",
              paddingStart: "20px",
              paddingEnd: "20px",
            },
            footer: {
              type: "box",
              layout: "vertical",
              spacing: "sm",
              contents: [],
              flex: 0,
              backgroundColor: "#FFEEA9",
            },
          },
        };

        try {
          if (liff.isInClient()) {
            await liff.sendMessages([flexMessage]);
          } else {
            await liff.shareTargetPicker([flexMessage]);
          }

          // ‚úÖ ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á LIFF ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
          liff.closeWindow();
        } catch (err) {
          console.error("LINE Flex Message Error:", err);
          alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE ‡πÑ‡∏î‡πâ: " + err.message);
        }
      }
    </script>
  </body>
</html>
